# sinoalgo_QA

This repository is for quality assurance of algo system

Tests are conducted by parsing the performance logs generated by trading system, the functions to parse and analyze keywords for each case are included in `qa_job/qa_func.py`.

To start a new test, one should assign the orders and cases in `resources/order.csv` and specify the purpose for each case, then run `main.py` to start the test for all cases in `orders.csv`.

## Program structure
```
├─main.py
│ 
├─resources                 
│      config.py   
│      orders.csv   
│      (log file)   
│          
├─qa_job
│      qa_main.py 
│      check_order_func.py   
│      parse_log_func.py 
│
```
### input
1. order_params: `'resources/orders.csv'`
2. example log file path: `'resources/sinoalgo-20220428T184032.log'`

Program parameters such as input/output paths are specified in `config/config.py`

### run test
`python main.py`

### output:
This script will output the result dataframe in `report/report.csv`, which contains four columns: ticker, purpose, result(True means pass, False means failed) and error msg. 

Following dataframe shows a successful test and a failed test of check_order_completion:

| ticker       | purpose                 | result | msg                                                     |
|--------------|-------------------------|--------|---------------------------------------------------------|
| 000001.XSHE  | check_order_completion  | True   ||
| 000001.XSHE  | check_order_completion  | False  | filled_size=9800, smaller than parent_order_size=10000  |



## Test cases

Currently, there are following test cases:

| Purpose                | Description                                                                                                                                                                                          | Param Examples                           | Pass conditions                                                                                                                                                                                      |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| check_order_completion | To test whether a parent order can be all filled                                                                                                                                                     |                                          | For VWAP, TWAP and IS, only parent order all filled is considered successful. For POV, if order size is much bigger than target execution size(market volume*target rate), take not finished as pass |
| check_order_lot        | To test whether the create sizes of orders are round lots, note that the odd lot of Tech Board is 200, and odd lot in other boards is 100                                                            |                                          | Each child order size meet the order lot conditions                                                                                                                                                  |
| check_noon_break       | To test if there is any order placement during noon break                                                                                                                                            |                                          | No order creation or cancellation during noon break                                                                                                                                                  |
| check_size_error       | When a wrong parent order size is assigned, test whether the algo can check the error                                                                                                                | ticker: 000001.XSHE, OrderSize: 60       | Throw parent size error message, and this parent order cannot be added                                                                                                                               |
| check_parent_time      | Assign a parent order start time before 9:30 or end time after 15:00, which should be corrected                                                                                                      | StartTime: 90000000,  EndTime: 153000000 | Correct the start \ end time, then add the parent order                                                                                                                                              |
| check_parent_rate      | Assign a parent order min rate smaller than 0 or max rate bigger than 1, which should be corrected                                                                                                   | minRate: -1                              | Correct the min \ max rate, then add the parent order                                                                                                                                                |
| check_rate_error       | When the assigned min rate is bigger than max rate, test if the algo can check this error                                                                                                            | minRate: 10                              | Throw parent rate error message, and this parent order cannot be added                                                                                                                               |                 
| check_target_rate      | For POV, when target rate is out of range, or not set, test if the algo can check this error                                                                                                         | Param: null                              | Throw target rate error message, and this parent order cannot be added                                                                                                                               |
| check_price_limit      | To test whether a wrong Plimit assigned by client can be checked                                                                                                                                     |                                          | Check the price limit before initing first quote, and once the price limit out range limit up down price, stop the parent order                                                                      |
| check_child_price      | To test whether the create price of limit orders is in the range of limit up and down, note that the limit up down percent is 20% for Tech Board, 30% for New Third Board, and 10% for other boards. |                                          | The create price of all child orders is in the range of limit up and down                                                                                                                            |

## Test results examples

### 1. 
Tests in `resources/orders1.csv` have been conducted, corresponding log is in `resources/sinoalgo-20220428T184032.log`, and the results are shown below:

| ticker      | purpose                | result | msg |
|-------------|------------------------|--------|-----|
| 000001.XSHE | check_order_completion | True   |     |
| 000001.XSHE | check_order_lot        | True   |     |
| 000001.XSHE | check_noon_break       | True   |     |
| 000001.XSHE | check_size_error       | True   |     |
| 688001.XSHG | check_size_error       | True   |     |
| 000001.XSHE | check_price_limit      | True   |     |
| 000001.XSHE | check_parent_time      | True   |     |
| 000001.XSHE | check_parent_time      | True   |     |
| 000001.XSHE | check_parent_rate      | True   |     |
| 000001.XSHE | check_rate_error       | True   |     |
| 000001.XSHE | check_target_rate      | True   |     |
| 688001.XSHG | check_target_rate      | True   |     |

### 2. 
Tests in `resources/orders.csv` have been conducted for POV cases and price limit cases, corresponding log is in `resources/sinoalgo-20220513T182652.log`, and the results are shown below:

| ticker      | purpose                | result | msg |
|-------------|------------------------|--------|-----|
| 000001.XSHE | check_order_completion | True   |     |
| 000001.XSHE | check_order_completion | True   |     |
| 000001.XSHE | check_price_limit      | True   |     |
| 000001.XSHE | check_price_limit      | True   |     |
